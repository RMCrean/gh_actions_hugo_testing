name: HTMLChecker
on: [push, pull_request]

jobs:
  html_checker:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v3
      with:
        hugo-version: '0.119.0'
      
    - name: Build Hugo
      run: hugo --minify

    - uses: actions/cache@v2
      with:
        path: tmp/.htmltest
        key: ${{ runner.os }}-htmltest

    - name: HTML Test
      run: |
        curl https://htmltest.wjdp.uk | bash
        bin/htmltest --config ${GITHUB_WORKSPACE}/.github/htmltest-config.yml

    - name: Archive htmltest results
      uses: actions/upload-artifact@v3
      with:
        name: htmltest-report
        path: tmp/.htmltest/htmltest.log
        retention-days: 7